<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FusionDash</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>

    <div id="wallpaper-layer"></div>
    <div id="wallpaper-overlay"></div>

    <div class="layout" id="main-layout">
        <aside id="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <i id="brand-logo" class="ph-fill ph-hexagon" style="color:var(--accent)"></i>
                    <span id="brand-text" class="brand-text">FusionDash</span>
                </div>
                <button id="sidebar-toggle" class="btn-ghost">
                    <i class="ph-bold ph-caret-double-left"></i>
                </button>
            </div>

            <nav id="board-nav">
                <div class="nav-label">BOARDS</div>
                <div id="board-list"></div>
                <button class="nav-item add-btn" id="create-board-btn">
                    <i class="ph-bold ph-plus"></i>
                    <span>New Board</span>
                </button>
            </nav>

            <nav id="system-nav">
                <div class="nav-label">SYSTEM</div>
                <button class="nav-item" id="nav-library">
                    <i class="ph ph-books"></i> <span>App Library</span>
                </button>
                <button class="nav-item" id="nav-settings">
                    <i class="ph ph-sliders"></i> <span>System Settings</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <div class="footer-info">v2.3</div>
            </div>
        </aside>

        <main>
            <header>
                <div class="header-left">
                    <h2 id="page-title">Loading...</h2>
                    <button class="btn-icon-small" id="board-settings-btn" title="Board Appearance">
                        <i class="ph-bold ph-pencil-simple"></i>
                    </button>
                </div>

                <div class="header-actions">
                    <div class="search-bar">
                        <i class="ph ph-magnifying-glass"></i>
                        <input type="text" id="search" placeholder="Search apps...">
                    </div>
                    <button id="header-add-section-btn" class="btn-accent">
                        <i class="ph-bold ph-rows"></i> <span>Add Section</span>
                    </button>
                </div>
            </header>

            <div id="board-view" class="view-container"></div>
            <div id="library-view" class="view-container hidden">
                <div class="library-stats">
                    <div class="stat-card">
                        <span id="total-count">0</span>
                        <label>Total Apps in Library</label>
                    </div>
                </div>
                <div id="library-grid" class="grid-compact"></div>
            </div>
        </main>
    </div>

    <div id="overlay"></div>

    <div id="board-modal" class="modal">
        <div class="modal-header"><h3>Board Appearance</h3><button class="close-modal"><i class="ph ph-x"></i></button></div>
        <div class="modal-body">
            <div class="field"><label>Board Name</label><input id="b-name" type="text"></div>
            <div class="field-group">
                <label>Wallpaper</label>
                <input id="b-wallpaper" type="text" placeholder="Image URL">
                <div class="control-row">
                    <div class="sub-field"><label>Blur</label><input id="b-blur" type="range" min="0" max="20"></div>
                    <div class="sub-field"><label>Dim</label><input id="b-opacity" type="range" min="0" max="0.9" step="0.1"></div>
                </div>
                <div class="sub-field" style="margin-top:10px;">
                    <label>Image Fit</label>
                    <select id="b-fit"><option value="cover">Cover</option><option value="contain">Contain</option></select>
                </div>
            </div>
            <div class="field-group">
                <label>Layout</label>
                <div class="control-row">
                    <div class="sub-field"><label>Style</label> <select id="b-style"><option value="standard">Standard</option><option value="wide">Wide</option><option value="neon">Neon</option></select></div>
                    <div class="sub-field"><label>Size</label> <select id="b-cardsize"><option value="small">Small</option><option value="medium">Medium</option><option value="large">Large</option></select></div>
                </div>
                <div class="field" style="margin-top:10px"><label>Alignment</label><select id="b-align"><option value="left">Left</option><option value="center">Center</option></select></div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="delete-board-btn" class="btn btn-danger-text">Delete Board</button>
            <button id="save-board-btn" class="btn btn-primary">Save Changes</button>
        </div>
    </div>

    <div id="section-modal" class="modal" style="width:300px;">
        <div class="modal-header"><h3>Edit Section</h3><button class="close-modal"><i class="ph ph-x"></i></button></div>
        <div class="modal-body">
            <div class="field"><label>Section Title</label><input id="sec-title" type="text"></div>
        </div>
        <div class="modal-footer">
            <button id="delete-section-btn" class="btn btn-danger-text">Delete</button>
            <button id="save-section-btn" class="btn btn-primary">Save</button>
        </div>
    </div>

    <div id="app-picker-modal" class="modal">
        <div class="modal-header"><h3>Add to Section</h3><button class="close-modal"><i class="ph ph-x"></i></button></div>
        <div class="modal-body">
            <p id="picker-target-msg" style="font-size:0.8rem; color:var(--dim); margin-bottom:10px;"></p>
            <div id="picker-list" class="picker-grid"></div>
            <div class="picker-footer">
                <button id="btn-add-status-widget" class="btn btn-secondary" style="width:auto; margin-bottom:10px;">
                    <i class="ph-bold ph-chart-bar"></i> Add Status Widget
                </button>
                <button id="btn-create-new" class="btn btn-primary" style="width:auto;">Create Manual Service</button>
            </div>
        </div>
    </div>

    <div id="global-settings-modal" class="modal">
         <div class="modal-header"><h3>System Settings</h3><button class="close-modal"><i class="ph ph-x"></i></button></div>
         <div class="modal-body">
            <div class="field-group">
                <label>Branding</label>
                <div class="field"><label>Name</label><input id="g-appname" type="text"></div>
                <div class="field"><label>Logo</label><input id="g-logo" type="text"></div>
            </div>
            <div class="field-group">
                <label>Theme</label>
                <div class="field"><label>Accent</label><input id="g-accent" type="color" style="height:40px;"></div>
                <div class="field"><label>Sidebar Opacity</label><input id="g-side-opacity" type="range" min="0.2" max="1" step="0.1"></div>
                <div class="field" style="margin-top:15px; display:flex; align-items:center; gap:10px;">
                    <input type="checkbox" id="g-autocollapse" style="width:auto;">
                    <label style="margin:0; cursor:pointer;" for="g-autocollapse">Start Sidebar Collapsed</label>
                </div>
            </div>
            <button id="btn-hard-reset" class="btn btn-danger">Reset All Data</button>
         </div>
         <div class="modal-footer">
            <button id="save-global-btn" class="btn btn-primary">Save Settings</button>
         </div>
    </div>

    <div id="editor-side">
        <h3>Edit Service</h3>
        <div class="field"><label>Display Name</label><input id="e-name" type="text"></div>
        <div class="field">
            <label>Card Type (Label)</label>
            <select id="e-source">
                <option value="docker">Docker</option>
                <option value="web">Web App</option>
                <option value="windows">Windows App</option>
                <option value="other">Other</option>
            </select>
        </div>
        <div class="field"><label>Description (Optional)</label><input id="e-desc" type="text" placeholder="Short info..."></div>
        
        <div class="field"><label>Tag (Category)</label><input id="e-group" type="text"></div>
        <div class="field"><label>URL</label><input id="e-href" type="text"></div>
        <div class="field"><label>Icon URL</label><input id="e-icon" type="text"></div>
        <div class="field-group" style="margin-top:20px;">
            <label>API Integration</label>
            <div class="field"><label>Widget Type</label><select id="e-widget"><option value="">None</option><option value="arr_queue">Arr Queue</option></select></div>
            <div class="field"><label>API Key</label><input id="e-apikey" type="password"></div>
        </div>
        <div class="actions-stack">
            <button id="save-service-btn" class="btn btn-primary">Save Changes</button>
            <button id="delete-service-btn" class="btn btn-secondary">Remove</button>
            <button id="close-editor" class="btn btn-text">Cancel</button>
        </div>
    </div>

    <script src="widgets.js"></script>
    <script src="render.js"></script>
    <script src="app.js"></script>
</body>
</html>